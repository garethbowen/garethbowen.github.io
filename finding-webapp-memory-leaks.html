<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Finding memory leaks in webapps - Gareth Bowen</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="apple-touch-icon" sizes="180x180" href="./logo/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./logo/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./logo/favicon-16x16.png">
    <link rel="manifest" href="./site.webmanifest">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Overlock+SC&display=swap" rel="stylesheet">
  </head>
  <body>
    <div>
      <div class="contact">
        <div class="logo">
          <a href="https://gareth.nz"><img src="./logo/logo-white.svg" alt="Gareth Bowen" width="50" /></a>
        </div>
        <div class="social">
          <ul>
            <li><a href="mailto:gareth@bowenwebdesign.co.nz"><img src="./icons/icons8-email-64.png" width="32" height="32" alt="Email Gareth Bowen"/></a></li>
            <li><a href="https://www.linkedin.com/in/garethjbowen/"><img src="./icons/icons8-linkedin-64.png" width="32" height="32" alt="View Gareth Bowen LinkedIn profile"/></a></li>
            <li><a href="https://github.com/garethbowen"><img src="./icons/icons8-github-64.png" width="32" height="32" alt="See Gareth's software development at GitHub"/></a></li>
            <li><a href="https://www.strava.com/athletes/13372622"><img src="./icons/icons8-strava-64.png" width="32" height="32" alt="Follow Gareth on Strava"/></a></li>
            <li><a href="https://mastodon.nz/@garethbowen"><img src="./icons/icons8-mastodon-64.png" width="32" height="32" alt="Lurking on mastodon"/></a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="banner">
      <div>
        <h1>Gareth Bowen</h1>
      </div>
    </div>
    <div class="section-title">
      <div>
        <h2>Finding memory leaks in webapps</h2>
        <p>13 February 2026</p>
      </div>
    </div>
    <div>
      <div>
        <p>Modern web application development often requires a complex network of reactive events which makes it very easy for developers to write JavaScript code which unwittingly holds on to references to objects that are no longer required. Furthermore if working on a Single Page Application the page is seldom reloaded, so this accumulation of objects can continue to grow until the app is closed. Retaining references blocks the garbage collector from freeing the memory used and over time this can become a limiting factor for the performance of your application.</p>
        <p>I've recently resolved a significant leak in a webapp, mostly through trial and error. This is an attempt to record what I've learned to make it easier next time.</p>
      </div>
    </div>
    <div class="splash">
      <div>
        <img src="./photos/memory-leaks.png" alt="Finding memory leaks in webapps" height="448" width="832">
        <p class="caption">Generated by Gemini</p>
      </div>
    </div>
    <div class="section-title">
      <div>
        <a id="setup" href="#setup"><h3>Setup</h3></a>
      </div>
    </div>
    <div>
      <div>
        <a id="testing-environment" href="#testing-environment"><h4>Testing environment</h4></a>
        <ol class="bullet">
          <li>Deploy the app to a production-like environment. Development environments may have additional hooks to refresh the code on change, or additional debug code, which may hold references, and/or complicate the memory snapshot. Deploying locally is ideal because you're going to be rebuilding and deploying frequently to debug this issue so it should be as quick as possible.</li>
          <li>Disable extensions (or use incognito mode) as these can interact with the page, adding to the noise, and potentially creating leaks of their own.</li>
          <li>Use Chrome's DevTools. Firstly because the tooling in Chrome is the best I've seen, and secondly because that's what the rest of this post is based on.</li>
        </ol>
        <a id="benchmark" href="#benchmark"><h4>Take a benchmark</h4></a>
        <ol class="bullet">
          <li>Somewhere near the bottom of the Memory tab you'll see “Total JS heap size” which is dynamically updated as you navigate around the page. If you have an action that you suspect may have a leak, execute it. Now click the little broom icon near the top which encourages the JS engine to collect garbage. Wait a few seconds for the heap size to stabilise and then record the number somewhere.</li>
          <li>Now pick a number of repetitions and perform the action again that many times. Garbage collect, and wait for the number to stabilise, then note the difference between the new heap size and the number you got the first time. Divide the difference by the number of repetitions to get a benchmark for how much memory the app is leaking every time the action is performed.</li>
        </ol>
        <p class="image"><img src="./photos/memory-leaks-snapshot.png" alt="Snapshot of memory usage" height="533" width="832"/></p>
        <p>Note that this number isn't accurate, which is why you should pick a reasonably large number of iterations, say 10. It may be that subsequent attempts will produce a different number - repeat the steps until you have reasonable confidence in your benchmark.</p>
        <p>If you found the heap size reliably increasing, congratulations, you have a leak. Now let's find it!</p>
      </div>
    </div>
    <div class="section-title">
      <div>
        <a id="finding-the-leak" href="#finding-the-leak"><h3>Finding the leak</h3></a>
      </div>
    </div>
    <div>
      <div>
        <ol class="bullet">
          <li>First select the Heap snapshot radio button. The other options are useful too but this is the best place to start.</li>
          <li>Execute the leaking action once.</li>
          <li>Click the garbage collection button, wait for a couple of seconds, then click the Take snapshot button. This takes a dump of memory usage, grouped by object type. So far, for anything other than a trivial application, this is useless. My app has 34,000 strings and there's no way I can figure out which are still useful and which aren't.</li>
          <li>Now, pick a smallish prime number. A prime number is useful because you want to detect objects being created some multiple of the number of times you executed the action. 5 is good because it's easy to spot numbers that are a multiple of 5. Do the action 5 times.</li>
          <li>You know the drill by now - garbage collect, wait 2 seconds, then take a snapshot.</li>
          <li>If you have a leak then you'll see the second snapshot is larger than the first. Select the 2nd snapshot.</li>
          <li>Now at the top of that pane there's a dropdown that's currently set to “Summary”. Summary is no good. Change it to “Comparison” to compare with the first snapshot. This shows how many objects have been cleared (# Deleted) and how many have been created (# New).</li>
          <li>But what we're interested in is objects that have been created but for which the previous objects have not been cleaned up. To find this, sort by the “Delta #” column and scroll down to find a delta of some multiple of 5 (or whatever number you picked in point 4). These are your leaking references.</li>
        </ol>
        <p class="image"><img src="./photos/memory-leaks-comparison.png" alt="Comparing memory snapshots" height="533" width="832"/></p>
      </div>
    </div>
    <div class="section-title">
      <div>
        <a id="fixing-the-leak" href="#fixing-the-leak"><h3>Fixing the leak</h3></a>
      </div>
    </div>
    <div>
      <div>
        <p>Once you've figured that out, the next challenge is finding the reason why all these objects are not being freed when the new ones are being created. Often these objects refer to each other which is all well and good, but one of them is holding on to a reference longer than it should.</p>
        <p>The first step is to select one of the objects that is being held, and you'll see the tree of “Retainers” in the bottom pane. It's going to take a lot of knowledge about your code, and more than a dash of patience, but once you find that one mischievous retainer the whole tree will get cleaned up.</p>
        <p>Some key things to look for are caches that never get invalidated, and event handlers that never get deregistered.</p>
        <p class="image"><img src="./photos/memory-leaks-retainers.png" alt="Finding memory retainers" height="533" width="832"/></p>
      </div>
    </div>
    <div class="section-title">
      <div>
        <a id="conclusion" href="#conclusion"><h3>Conclusion</h3></a>
      </div>
    </div>
    <div>
      <div>
        <p>Debugging memory leaks is hard. Today's SPAs have thousands of objects with complex relationships which makes it difficult for developers and tools to trace the leaks back to the source.</p>
        <p>As for my experience, I found multiple leaks in the form submission of my application.</p>
        <ul class="bullet">
          <li>We had a cache that was added prematurely for performance optimisation but the entries were never invalidated.</li>
          <li>We use <a href="https://www.solidjs.com">SolidJS</a> which is a reactive library for updating the UI when the underlying model changes, but we never disposed of the old listening scopes.</li>
          <li>But the worst leak was in the <a href="https://openlayers.org">OpenLayers</a> library which renders maps and a whole lot of event listeners. Following down a rabbit hole of issues and posts I eventually found code to forcibly deregister the listeners and free the caches.</li>
        </ul>
        <p>Fixing these got my memory leak down from 5MB per action, to 200kB which I decided was within the margin of error - issue closed.</p>
      </div>
    </div>
    <div>
      <div>
        <p>To read more, I highly recommend <a href="https://nolanlawson.com/2022/01/05/memory-leaks-the-forgotten-side-of-web-performance/">Nolan Lawson's memory leaks post</a>.</p>
      </div>
    </div>
    <div class="footer">
      <div>
        &copy; Gareth Bowen
      </div>
    </div>
  </body>
</html>
